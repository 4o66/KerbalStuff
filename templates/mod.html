{% extends "layout.html" %}
{% block scripts %}
{% endblock %}
{% block title %}
<title>{{ mod.name }} on Kerbal Stuff</title>
{% endblock %}
{% block styles %}
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='mod.css') }}" />
<style>
.download-link { left: calc(60% - 300px); }
.sexy-nav li.active, .sexy-nav li:hover {
    background-image: url('https://mediacru.sh{{ mod.background }}'); 
}
</style>
{% endblock %}
{% block body %}
<div class="jumbotron modtron" style="background-image: url('https://mediacru.sh{{ mod.background }}')">
    <div class="inner">
        <h1>{{ mod.name }}</h1>
        <p>{{ mod.short_description }}</p>
    </div>
    <div class="download-link" style="background-image: url('https://mediacru.sh{{ mod.background }}')">
        {% if not mod.published %}
        <a href="/mod/{{ mod.id }}/{{ safe_name }}/publish" class="red">Publish Mod</a>
        {% else %}
        <a href="/mod/{{ mod.id }}/{{ safe_name }}/download/{{ mod.versions[0].friendly_version }}">Download Latest Version</a>
        {% endif %}
    </div>
    <ul class="controls">
        <li>
            <span class="left">
                <span class="glyphicon glyphicon-transfer"></span> {{ mod.license }}
            </span>
        </li>
        <li>
            <span class="left">
                <span class="glyphicon glyphicon-check"></span> KSP Version
            </span>
            <span class="right">
                0.23.5
            </span>
        </li>
        {% if mod.source_link %}
        <li>
            <span class="left">
                <span class="glyphicon glyphicon-tasks"></span> Source Code
            </span>
            <span class="right">
                <a target="_blank" href="{{ mod.source_link }}">Browse</a>
            </span>
        </li>
        {% endif %}
        {% if mod.external_link %}
        <li>
            <span class="left">
                <span class="glyphicon glyphicon-globe"></span> Mod Website
            </span>
            <span class="right">
                <a target="_blank" href="{{ mod.external_link }}">Visit</a>
            </span>
        </li>
        {% endif %}
        {% if mod.donate_link %}
        <li>
            <span class="left">
                <span class="glyphicon glyphicon-gift"></span> Support this mod
            </span>
            <span class="right">
                <a target="_blank" href="{{ mod.donate_link }}">Donate</a>
            </span>
        </li>
        {% endif %}
        <li>
            <span class="left">
                <span class="glyphicon glyphicon-cloud-download"></span> {{ mod.download_count }} Downloads
            </span>
            <span class="right green">
                <a href="/mod/{{ mod.id }}/{{ safe_name }}/download/{{ mod.versions[0].friendly_version }}" class="green">Download</a>
            </span>
        </li>
        <li>
            <span class="left">
                <span class="glyphicon glyphicon-heart-empty"></span> {{ mod.follower_count }} Followers
            </span>
            <span class="right red">
                {% if following_mod(mod) %}
                <a href="#" class="unfollow-button" data-mod="{{ mod.id }}" data-id=="{{ mod.id }}">Unfollow</a>
                {% else %}
                <a href="#" class="follow-button" data-mod="{{ mod.id }}" data-id=="{{ mod.id }}">Follow</a>
                {% endif %}
            </span>
        </li>
    </ul>
</div>
<div class="sexy-nav-wrapper">
    <ul class="nav nav-pills sexy-nav" style="width: 368px; margin: 0 auto; padding-top: 2px;">
        <li class="active"><a data-toggle="tab" href="#description">Description</a></li>
        <li><a data-toggle="tab" href="#changelog">Changelog</a></li>
        <li><a data-toggle="tab" href="#versions">Versions</a></li>
    </ul>
</div>
<div class="tab-content">
    <div class="tab-pane active fade in" id="description">
        <div class="markdown">
            {{ mod.description | firstparagraph | markdown }}
        </div>
        <div id="media-carousel" class="carousel slide" data-ride="carousel" data-pause="hover">
            <ol class="carousel-indicators">
                {% for v in videos %}
                {% if loop.index == 1 %}
                <li data-target="#media-carousel" data-slide-to="{{ loop.index - 1 }}" class="active"></li>
                {% else %}
                <li data-target="#media-carousel" data-slide-to="{{ loop.index - 1 }}"></li>
                {% endif %}
                {% endfor %}
                {% for v in screens %}
                {% if loop.index == 1 and len(videos) == 0 %}
                <li data-target="#media-carousel" data-slide-to="{{ loop.index - 1 + len(videos) }}" class="active"></li>
                {% else %}
                <li data-target="#media-carousel" data-slide-to="{{ loop.index - 1 + len(videos) }}"></li>
                {% endif %}
                {% endfor %}
            </ol>
            <div class="carousel-inner">
                {% for v in videos %}
                {% if loop.index == 1 %}
                <div class="item active">
                    <iframe src="https://mediacru.sh/{{ v.data }}/frame" frameborder="0" allowFullscreen width="700" height="400"></iframe>
                </div>
                {% else %}
                <div class="item">
                    <iframe src="https://mediacru.sh/{{ v.data }}/frame" frameborder="0" allowFullscreen width="700" height="400"></iframe>
                </div>
                {% endif %}
                {% endfor %}
                {% for s in screens %}
                {% if loop.index == 1 and len(videos) == 0 %}
                <div class="item active"><a href="https://mediacru.sh{{ s.data }}"><img src="https://mediacru.sh{{ s.data }}"></a></div>
                {% else %}
                <div class="item"><a href="https://mediacru.sh{{ s.data }}"><img src="https://mediacru.sh{{ s.data }}"></a></div>
                {% endif %}
                {% endfor %}
            </div>
        </div>
        <div class="markdown">
            {{ mod.description | remainingparagraphs | markdown }}
        </div>
    </div>
    <div class="tab-pane fade centered" id="changelog">
        {% if len(mod.versions) == 1 %}
        <h3 class="borderh">{{ latest.friendly_version }}</h3>
        <p>The first version of {{ mod.name }}.</p>
        {% else %}
        {% for v in mod.versions %}
        <h3 class="borderh">{{ v.friendly_version }} <small>KSP {{ v.ksp_version }}</small></h3>
        {% if v.changelog %}
        <div style="width: 500px; margin: 0 auto; text-align: left;">
            {{ v.changelog | markdown }}
        </div>
        {% else %}
        <p><em>No changelog provided</em></p>
        {% endif %}
        {% endfor %}
        {% endif %}
    </div>
    <div class="tab-pane fade" id="versions">
        <table class="table">
            <thead>
                <tr>
                    <th>Mod Version</th>
                    <th>KSP Version</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                {% for v in mod.versions %}
                <tr>
                    <td>{{ v.friendly_version }}</td>
                    <td>{{ v.ksp_version }}</td>
                    <td><a href="/mod/{{ mod.id }}/{{ safe_name }}/download/{{ v.friendly_version }}">Download</a></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </diV>
</div>
{% if user and user.id == mod.user_id or admin %}
<div class="modal fade" id="confirm-delete" tabindex="-1" role="dialog" aria-labelledby="confirm-delete" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="myModalLabel">Delete Mod</h4>
            </div>
            <div class="modal-body">
                <p>
                Are you really, really, really sure you want to delete this mod? You can't undo this.</p>
            </div>
            <div class="modal-footer">
                <form action="/mod/{{ mod.id }}/delete" method="POST">
                    <a href="#" class="btn btn-default" data-dismiss="modal">Cancel</a>
                    <input type="submit" class="btn btn-danger" value="Delete Mod">
                </form>
            </div>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}
